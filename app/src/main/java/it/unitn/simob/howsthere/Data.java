package it.unitn.simob.howsthere;

import android.app.ProgressDialog;
import android.content.Context;
import android.content.Intent;
import android.graphics.Color;
import android.net.ConnectivityManager;
import android.os.Bundle;
import android.support.v4.content.ContextCompat;
import android.support.v7.app.AppCompatActivity;
import android.util.Log;
import android.view.View;
import android.widget.TextView;
import android.widget.Toast;

import com.github.mikephil.charting.charts.LineChart;
import com.github.mikephil.charting.components.AxisBase;
import com.github.mikephil.charting.components.XAxis;
import com.github.mikephil.charting.components.YAxis;
import com.github.mikephil.charting.data.Entry;
import com.github.mikephil.charting.data.LineData;
import com.github.mikephil.charting.data.LineDataSet;
import com.github.mikephil.charting.formatter.IAxisValueFormatter;
import com.github.mikephil.charting.formatter.IFillFormatter;
import com.github.mikephil.charting.interfaces.dataprovider.LineDataProvider;
import com.github.mikephil.charting.interfaces.datasets.ILineDataSet;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import okhttp3.ResponseBody;
import retrofit2.Call;
import retrofit2.Callback;
import retrofit2.Response;
import retrofit2.Retrofit;
import retrofit2.http.GET;
import retrofit2.http.Path;
import retrofit2.http.Query;

public class Data extends AppCompatActivity {

    private String id = null;
    private String gPeak = null;
    private Retrofit retrofit = null;
    private TextView idt = null;
    private ProgressDialog progressDialog;

    //Le richieste GET vengono gestite dalla libreria RetroFit

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_data);

        Intent i = getIntent();
        Double lat = i.getDoubleExtra("lat", 0.0);
        Double lng = i.getDoubleExtra("long", 0.0);
        String data = i.getStringExtra("data");

        if(data == null){
            data = "Data non selezionata!";
        }

        TextView latT = (TextView) findViewById(R.id.latT);
        TextView longT = (TextView) findViewById(R.id.longT);
        TextView dataT = (TextView) findViewById(R.id.dateT);
        idt = (TextView) findViewById(R.id.idt);

        latT.setText("" + lat);
        longT.setText("" + lng);
        dataT.setText("" + data);

        //Preparo la finestra di caricamento
        progressDialog = new ProgressDialog(Data.this);
        progressDialog.setMax(100);
        progressDialog.setProgressStyle(ProgressDialog.STYLE_SPINNER);

        //Variabile Retrofit per gestire tutte le richieste GET
        retrofit = new Retrofit.Builder()
                .baseUrl("http://www.heywhatsthat.com/")
                .build();

        if (savedInstanceState != null) {
            // Se c'è un istanza salvata non richiedo nuovamente i dati
            String savedID = savedInstanceState.getString("ID");
            String savedPeak = savedInstanceState.getString("peak");
            id = savedID;
            gPeak = savedPeak;
            idt.setText(savedID);
            setPeak(savedPeak);
        }else{
            callsAPI(lat, lng);
        }
    }

    /**
     * Salvataggio dell'istanza
     */
    @Override
    protected void onSaveInstanceState (Bundle outState) {
        super.onSaveInstanceState(outState);
        outState.putCharSequence("ID", id);
        outState.putCharSequence("peak", gPeak);
    }

    /**
     * Interfacce per le richieste GET
     */
    public interface HeyWhatsID {
        @GET("api/query?src=hows")
        Call<ResponseBody> getID(@Query("lat") Double lat, @Query("lon") Double lon);
    }

    public interface HeyWhatsReady {
        @GET("api/ready?src=hows")
        Call<ResponseBody> getStatus(@Query("id") String ID);
    }

    public interface HeyWhatsPeak {
        @GET("api/horizon.csv?resolution=.999")
        Call<ResponseBody> getPeak(@Query("id") String ID);
    }

    private void callsAPI(Double lat, Double lng){
        HeyWhatsID service = retrofit.create(HeyWhatsID.class);
        Call<ResponseBody> call = service.getID(lat, lng);
        call.enqueue(new Callback<ResponseBody>() {
            @Override
            public void onResponse(Call<ResponseBody> call, Response<ResponseBody> response) {
                if (response.isSuccessful()) {
                    try {
                        id = response.body().string();
                        idt.post(new Runnable() {
                            @Override
                            public void run() {
                                idt.setText(id);
                            }
                        });
                        checkStatus(id); //Ottenuto l'ID controllo lo stato della generazione del panorama
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                } else {
                    Toast.makeText(getApplicationContext(), "Impossibile caricare l'ID!", Toast.LENGTH_SHORT).show();
                }
            }
            @Override
            public void onFailure(Call<ResponseBody> call, Throwable t) {
                Log.d("Errore: ", t.getMessage());
            }
        });
    }

    private void checkStatus(final String idpass){
        HeyWhatsReady service = retrofit.create(HeyWhatsReady.class);
        Call<ResponseBody> call = service.getStatus(idpass);

        progressDialog.setMessage("Eseguendo il panorama...");
        progressDialog.setTitle("Attendere (1 minuto)...");
        progressDialog.show(); //Avvio la finestra di dialogo con il caricamento

        call.enqueue(new Callback<ResponseBody>() {
            @Override
            public void onResponse(Call<ResponseBody> call, Response<ResponseBody> response) {
                if (response.isSuccessful()) {
                    try {
                        String status = response.body().string();
                        if(status.length() > 0 && status.charAt(0) == '1'){ // Se la mappa è pronta vado ad ottenere il panorama
                            loadPeakData(idpass);
                        }else{ //Altrimenti aspetto e riprovo dopo 10 secondi
                            Thread.sleep(10000);
                            checkStatus(idpass);
                        }
                    } catch (IOException e) {
                        e.printStackTrace();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                } else {
                    Toast.makeText(getApplicationContext(), "La mappa non è stata generata!", Toast.LENGTH_SHORT).show();
                }
                progressDialog.dismiss();
            }

            @Override
            public void onFailure(Call<ResponseBody> call, Throwable t) {
                Log.d("Errore: ", t.getMessage());
                progressDialog.dismiss();
            }
        });
    }

    private void loadPeakData(String idpass){
        HeyWhatsPeak service = retrofit.create(HeyWhatsPeak.class);
        Call<ResponseBody> call = service.getPeak(idpass);

        progressDialog.setMessage("Caricando l'orizzonte...");
        progressDialog.setTitle("Attendere...");
        progressDialog.show(); //Avvio la finestra di dialogo con il caricamento

        call.enqueue(new Callback<ResponseBody>() {
            @Override
            public void onResponse(Call<ResponseBody> call, Response<ResponseBody> response) {
                if (response.isSuccessful()) {
                    try {
                        gPeak = response.body().string();
                        setPeak(gPeak);
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                } else {
                    Toast.makeText(getApplicationContext(), "Impossibile caricare i picchi!", Toast.LENGTH_SHORT).show();
                }
                progressDialog.dismiss();
            }
            @Override
            public void onFailure(Call<ResponseBody> call, Throwable t) {
                Log.d("Error", t.getMessage());
                progressDialog.dismiss();
            }
        });
    }

    private void setPeak(String peak){
        String traiettoria = "\"bin bottom\",azimuth,altitude,\"distance (m)\",latitude,longitude,\"elevation (m amsl)\"\n" +
                "0.5,1.44638,7.886562,3355.584946,46.089167,11.234167,930.000000\n" +
                "1.5,2.556457,8.438239,3362.515697,46.089167,11.235000,963.000000\n" +
                "2.5,2.556457,8.438239,3362.515697,46.089167,11.235000,963.000000\n" +
                "3.5,3.664615,8.328422,3365.100140,46.089167,11.235833,957.000000\n" +
                "4.5,3.880497,7.920394,3174.996719,46.087500,11.235833,907.000000\n" +
                "5.5,4.906252,7.736875,3271.806265,46.088333,11.236667,910.000000\n" +
                "6.5,6.039169,7.167405,3273.739691,46.088333,11.237500,878.000000\n" +
                "7.5,6.969423,6.415798,3368.591340,46.089167,11.238333,846.000000\n" +
                "8.5,9.982158,6.818430,2734.715853,46.083333,11.239167,794.000000\n" +
                "9.5,11.316028,7.595250,2751.447963,46.083333,11.240000,833.000000\n" +
                "10.5,11.316028,7.595250,2751.447963,46.083333,11.240000,833.000000\n" +
                "11.5,13.075924,8.046880,2676.736547,46.082500,11.240833,844.000000\n" +
                "12.5,13.075924,8.046880,2676.736547,46.082500,11.240833,844.000000\n" +
                "13.5,13.075924,8.046880,2676.736547,46.082500,11.240833,844.000000\n" +
                "14.5,14.939197,7.992980,2601.366323,46.081667,11.241667,831.000000\n" +
                "15.5,16.184845,8.016215,4273.582619,46.095833,11.248333,1066.000000\n" +
                "16.5,16.184845,8.016215,4273.582619,46.095833,11.248333,1066.000000\n" +
                "17.5,18.552772,8.252143,3541.737267,46.089167,11.247500,978.000000\n" +
                "18.5,20.062381,8.539415,3477.515238,46.088333,11.248333,986.000000\n" +
                "19.5,21.064536,8.791543,3502.781046,46.088333,11.249167,1005.000000\n" +
                "20.5,21.064536,8.791543,3502.781046,46.088333,11.249167,1005.000000\n" +
                "21.5,22.912382,9.211718,5081.600741,46.100833,11.258333,1284.000000\n" +
                "22.5,23.8311,9.804573,5228.699583,46.101667,11.260000,1361.000000\n" +
                "23.5,24.915395,10.328095,5178.502413,46.100833,11.260833,1399.000000\n" +
                "24.5,24.915395,10.328095,5178.502413,46.100833,11.260833,1399.000000\n" +
                "25.5,26.905642,10.180027,5686.631656,46.104167,11.265833,1476.000000\n" +
                "26.5,27.790748,10.289050,5521.325073,46.102500,11.265833,1457.000000\n" +
                "27.5,28.253661,10.308797,5438.549837,46.101667,11.265833,1444.000000\n" +
                "28.5,29.73087,10.497490,5194.603571,46.099167,11.265833,1417.000000\n" +
                "29.5,30.354605,10.551291,5228.364416,46.099167,11.266667,1428.000000\n" +
                "30.5,30.354605,10.551291,5228.364416,46.099167,11.266667,1428.000000\n" +
                "31.5,30.970476,10.410472,5259.425911,46.099167,11.267500,1421.000000\n" +
                "32.5,32.060731,9.636454,5086.620484,46.097500,11.267500,1322.000000\n" +
                "33.5,33.355581,9.044544,5376.987343,46.099167,11.270833,1316.000000\n" +
                "34.5,33.950247,8.760164,5523.138402,46.100000,11.272500,1312.000000\n" +
                "35.5,35.06854,8.555818,5365.746486,46.098333,11.272500,1269.000000\n" +
                "36.5,35.829556,8.203776,4372.368040,46.090833,11.265833,1094.000000\n" +
                "37.5,38.397774,8.174710,3806.236769,46.085833,11.263333,1011.000000\n" +
                "38.5,38.397774,8.174710,3806.236769,46.085833,11.263333,1011.000000\n" +
                "39.5,39.290388,8.074421,3732.419734,46.085000,11.263333,994.000000\n" +
                "40.5,40.055188,7.790724,3771.395601,46.085000,11.264167,981.000000\n" +
                "41.5,40.80318,7.422106,3810.324930,46.085000,11.265000,962.000000\n" +
                "42.5,43.326659,7.445546,14509.872833,46.153333,11.360833,2363.000000\n" +
                "43.5,43.62764,7.420169,14711.058461,46.154167,11.363333,2383.000000\n" +
                "44.5,44.679007,7.059796,14701.176040,46.152500,11.365833,2290.000000\n" +
                "45.5,45.637317,6.629113,14536.681100,46.150000,11.366667,2161.000000\n" +
                "46.5,46.500071,6.555608,15307.433474,46.153333,11.375833,2232.000000\n" +
                "47.5,48.350085,6.315479,15287.219803,46.150000,11.380000,2166.000000\n" +
                "48.5,49.30412,6.623837,15161.737016,46.147500,11.380833,2233.000000\n" +
                "49.5,50.201316,6.697402,15302.241665,46.146667,11.384167,2269.000000\n" +
                "50.5,50.625451,6.634523,15290.978290,46.145833,11.385000,2251.000000\n" +
                "51.5,51.599077,6.625772,15165.942647,46.143333,11.385833,2234.000000\n" +
                "52.5,52.737699,6.184651,15083.987170,46.140833,11.387500,2109.000000\n" +
                "53.5,54.324305,6.461102,14548.440211,46.135000,11.385000,2120.000000\n" +
                "54.5,55.357518,6.448743,10979.598442,46.115000,11.349167,1710.000000\n" +
                "55.5,56.324536,6.764806,11095.706075,46.114167,11.351667,1784.000000\n" +
                "56.5,57.316898,7.040987,11054.706609,46.112500,11.352500,1832.000000\n" +
                "57.5,58.317539,7.280887,11016.359908,46.110833,11.353333,1873.000000\n" +
                "58.5,59.152484,7.433827,10923.434461,46.109167,11.353333,1890.000000\n" +
                "59.5,60.365704,7.810534,10201.108355,46.104167,11.346667,1862.000000\n" +
                "60.5,61.36385,8.073523,10924.735533,46.105833,11.355833,2011.000000\n" +
                "61.5,62.477128,8.372836,10527.042865,46.102500,11.352500,2009.000000\n" +
                "62.5,63.250903,8.699746,10609.690603,46.101667,11.354167,2081.000000\n" +
                "63.5,64.162805,9.079328,10537.904119,46.100000,11.354167,2139.000000\n" +
                "64.5,65.385846,9.014471,10574.457511,46.098333,11.355833,2133.000000\n" +
                "65.5,66.276866,9.508972,10730.214166,46.097500,11.358333,2249.000000\n" +
                "66.5,67.202456,9.738484,10663.569067,46.095833,11.358333,2280.000000\n" +
                "67.5,68.27119,10.097253,10664.949115,46.094167,11.359167,2346.000000\n" +
                "68.5,69.217264,10.219675,10601.058497,46.092500,11.359167,2357.000000\n" +
                "69.5,70.420255,10.265062,10382.412887,46.090000,11.357500,2326.000000\n" +
                "70.5,71.289755,10.265971,10258.988310,46.088333,11.356667,2304.000000\n" +
                "71.5,71.674742,10.329769,10169.107575,46.087500,11.355833,2299.000000\n" +
                "72.5,72.688544,10.287214,10110.348186,46.085833,11.355833,2281.000000\n" +
                "73.5,75.358772,10.513683,2935.340496,46.065833,11.269167,1005.000000\n" +
                "74.5,75.490819,10.857951,8633.589698,46.078333,11.339167,2100.000000\n" +
                "75.5,77.432501,11.370001,2985.618117,46.065000,11.270000,1058.000000\n" +
                "76.5,78.204853,11.526963,3180.319905,46.065000,11.272500,1105.000000\n" +
                "77.5,79.446458,12.256561,3041.032809,46.064167,11.270833,1115.000000\n" +
                "78.5,79.88213,12.474929,3173.558676,46.064167,11.272500,1155.000000\n" +
                "79.5,81.39843,13.042224,3099.939838,46.063333,11.271667,1169.000000\n" +
                "80.5,81.577058,13.204278,3167.512441,46.063333,11.272500,1193.000000\n" +
                "81.5,83.286911,13.695752,3161.515439,46.062500,11.272500,1218.000000\n" +
                "82.5,83.424078,13.874284,3229.933092,46.062500,11.273333,1244.000000\n" +
                "83.5,85.303374,14.576622,3363.322682,46.061667,11.275000,1316.000000\n" +
                "84.5,85.303374,14.576622,3363.322682,46.061667,11.275000,1316.000000\n" +
                "85.5,86.991148,15.461197,3437.684092,46.060833,11.275833,1386.000000\n" +
                "86.5,86.991148,15.461197,3437.684092,46.060833,11.275833,1386.000000\n" +
                "87.5,88.593006,16.229674,3447.153319,46.060000,11.275833,1433.000000\n" +
                "88.5,90.197018,16.616297,3453.059265,46.059167,11.275833,1457.000000\n" +
                "89.5,90.197018,16.616297,3453.059265,46.059167,11.275833,1457.000000\n" +
                "90.5,90.197018,16.616297,3453.059265,46.059167,11.275833,1457.000000\n" +
                "91.5,91.800672,16.497087,3452.657026,46.058333,11.275833,1450.000000\n" +
                "92.5,91.800672,16.497087,3452.657026,46.058333,11.275833,1450.000000\n" +
                "93.5,93.153643,16.206602,3720.215262,46.057500,11.279167,1508.000000\n" +
                "94.5,94.552253,15.966067,3789.187850,46.056667,11.280000,1512.000000\n" +
                "95.5,94.720388,15.782870,3652.106310,46.056667,11.278333,1463.000000\n" +
                "96.5,96.109763,15.535997,3723.480244,46.055833,11.279167,1467.000000\n" +
                "97.5,97.715041,14.928126,3658.033411,46.055000,11.278333,1412.000000\n" +
                "98.5,97.715041,14.928126,3658.033411,46.055000,11.278333,1412.000000\n" +
                "99.5,100.402671,14.296563,4825.882714,46.051667,11.292500,1662.000000\n" +
                "100.5,100.402671,14.296563,4825.882714,46.051667,11.292500,1662.000000\n" +
                "101.5,101.514873,14.095634,4839.825032,46.050833,11.292500,1649.000000\n" +
                "102.5,102.360426,13.891572,4510.429935,46.050833,11.288333,1553.000000\n" +
                "103.5,103.945047,13.763981,4400.366765,46.050000,11.286667,1517.000000\n" +
                "104.5,103.945047,13.763981,4400.366765,46.050000,11.286667,1517.000000\n" +
                "105.5,104.832801,13.513426,4138.628677,46.050000,11.283333,1437.000000\n" +
                "106.5,105.850181,13.237703,4223.035536,46.049167,11.284167,1437.000000\n" +
                "107.5,106.825189,12.852390,4306.731972,46.048333,11.285000,1428.000000\n" +
                "108.5,107.910209,12.429045,4047.401692,46.048333,11.281667,1341.000000\n" +
                "109.5,108.877628,11.765288,4129.782159,46.047500,11.282500,1312.000000\n" +
                "110.5,109.808649,11.139879,3934.533743,46.047500,11.280000,1230.000000\n" +
                "111.5,110.754372,10.646596,4022.298639,46.046667,11.280833,1213.000000\n" +
                "112.5,111.79754,9.867181,3829.347358,46.046667,11.278333,1126.000000\n" +
                "113.5,114.72457,9.573424,5640.584029,46.038333,11.298333,1409.000000\n" +
                "114.5,115.585054,9.834916,5685.054233,46.037500,11.298333,1442.000000\n" +
                "115.5,116.433315,10.188536,5732.635999,46.036667,11.298333,1485.000000\n" +
                "116.5,117.570755,10.363679,5720.235242,46.035833,11.297500,1500.000000\n" +
                "117.5,117.570755,10.363679,5720.235242,46.035833,11.297500,1500.000000\n" +
                "118.5,120.034364,10.401711,5478.975021,46.035000,11.293333,1460.000000\n" +
                "119.5,120.805322,10.594315,4990.677117,46.036667,11.287500,1388.000000\n" +
                "120.5,121.72536,10.694430,5041.319563,46.035833,11.287500,1406.000000\n" +
                "121.5,121.72536,10.694430,5041.319563,46.035833,11.287500,1406.000000\n" +
                "122.5,122.122624,10.653502,4984.928162,46.035833,11.286667,1392.000000\n" +
                "123.5,122.944271,10.451593,4871.040018,46.035833,11.285000,1354.000000\n" +
                "124.5,123.864057,9.896123,4914.373269,46.035000,11.285000,1315.000000\n" +
                "125.5,125.646266,9.623091,3567.347213,46.040833,11.270000,1066.000000\n" +
                "126.5,125.646266,9.623091,3567.347213,46.040833,11.270000,1066.000000\n" +
                "127.5,126.909472,9.389308,3459.491352,46.040833,11.268333,1034.000000\n" +
                "128.5,127.570207,9.065772,3404.310860,46.040833,11.267500,1006.000000\n" +
                "129.5,128.800364,8.129222,3453.771342,46.040000,11.267500,958.000000\n" +
                "130.5,130.196757,7.388144,3347.290226,46.040000,11.265833,900.000000\n" +
                "131.5,130.682646,6.891132,3453.646995,46.039167,11.266667,884.000000\n" +
                "132.5,134.83124,6.536950,2133.345190,46.045833,11.252500,712.000000\n" +
                "133.5,134.83124,6.536950,2133.345190,46.045833,11.252500,712.000000\n" +
                "134.5,136.087873,6.705835,2088.526595,46.045833,11.251667,713.000000\n" +
                "135.5,136.087873,6.705835,2088.526595,46.045833,11.251667,713.000000\n" +
                "136.5,136.087873,6.705835,2088.526595,46.045833,11.251667,713.000000\n" +
                "137.5,136.087873,6.705835,2088.526595,46.045833,11.251667,713.000000\n" +
                "138.5,137.806324,6.574378,2156.132414,46.045000,11.251667,716.000000\n" +
                "139.5,139.111162,6.465041,2112.615284,46.045000,11.250833,707.000000\n" +
                "140.5,139.111162,6.465041,2112.615284,46.045000,11.250833,707.000000\n" +
                "141.5,140.469527,6.210056,2069.684070,46.045000,11.250000,693.000000\n" +
                "142.5,142.055506,5.893882,2141.134212,46.044167,11.250000,689.000000\n" +
                "143.5,142.210477,5.446824,2252.714999,46.043333,11.250833,683.000000\n" +
                "144.5,143.536324,5.207715,2212.745322,46.043333,11.250000,670.000000\n" +
                "145.5,147.539671,4.848916,2328.300834,46.041667,11.249167,666.000000\n" +
                "146.5,147.539671,4.848916,2328.300834,46.041667,11.249167,666.000000\n" +
                "147.5,147.539671,4.848916,2328.300834,46.041667,11.249167,666.000000\n" +
                "148.5,147.539671,4.848916,2328.300834,46.041667,11.249167,666.000000\n" +
                "149.5,149.592805,4.611829,11434.796714,45.970833,11.307500,1397.000000\n" +
                "150.5,150.541431,4.579790,13353.291145,45.955000,11.317500,1547.000000\n" +
                "151.5,151.544767,4.395530,13643.976755,45.951667,11.316667,1527.000000\n" +
                "152.5,152.581935,4.238223,12987.967326,45.955833,11.310000,1440.000000\n" +
                "153.5,153.728081,4.057702,12336.681316,45.960000,11.303333,1352.000000\n" +
                "154.5,154.610754,4.110649,11526.537971,45.965833,11.296667,1304.000000\n" +
                "155.5,156.455606,4.152251,11562.404976,45.964167,11.292500,1315.000000\n" +
                "156.5,157.401661,4.309221,11685.134154,45.962500,11.290833,1356.000000\n" +
                "157.5,158.455467,4.553238,11702.293846,45.961667,11.288333,1407.000000\n" +
                "158.5,159.441124,4.780955,11132.646020,45.965833,11.283333,1405.000000\n" +
                "159.5,160.23085,4.854402,11176.553278,45.965000,11.281667,1423.000000\n" +
                "160.5,160.544334,4.863978,11154.984842,45.965000,11.280833,1423.000000\n" +
                "161.5,162.420395,4.948604,11230.031044,45.963333,11.276667,1446.000000\n" +
                "162.5,163.23437,5.097037,11086.373429,45.964167,11.274167,1462.000000\n" +
                "163.5,163.555939,5.203594,11069.754787,45.964167,11.273333,1481.000000\n" +
                "164.5,165.384751,5.444039,10880.344164,45.965000,11.268333,1509.000000\n" +
                "165.5,165.928903,5.570069,10760.367273,45.965833,11.266667,1521.000000\n" +
                "166.5,166.715487,5.233194,10814.071079,45.965000,11.265000,1463.000000\n" +
                "167.5,167.598373,4.737851,10958.313228,45.963333,11.263333,1382.000000\n" +
                "168.5,169.263883,4.619677,10891.528503,45.963333,11.259167,1354.000000\n" +
                "169.5,169.599288,4.640530,10879.986038,45.963333,11.258333,1357.000000\n" +
                "170.5,170.609741,4.449632,10843.689664,45.963333,11.255833,1318.000000\n" +
                "171.5,171.553914,4.234534,10718.661121,45.964167,11.253333,1268.000000\n" +
                "172.5,173.492325,4.048045,11603.534877,45.955833,11.250000,1297.000000\n" +
                "173.5,173.81033,4.075226,11596.784217,45.955833,11.249167,1302.000000\n" +
                "174.5,174.637937,3.921199,11297.820920,45.958333,11.246667,1250.000000\n" +
                "175.5,175.691202,3.568158,11461.819396,45.956667,11.244167,1191.000000\n" +
                "176.5,177.378042,3.627400,20271.689592,45.877500,11.245000,1779.000000\n" +
                "177.5,178.102077,3.728853,20171.112007,45.878333,11.241667,1808.000000\n" +
                "178.5,179.013943,3.677708,19976.096288,45.880000,11.237500,1777.000000\n" +
                "179.5,179.567882,3.670683,19787.830469,45.881667,11.235000,1762.000000\n" +
                "180.5,181.489998,3.683763,9205.872881,45.976667,11.230000,1066.000000\n" +
                "181.5,182.295041,3.893034,9212.415104,45.976667,11.228333,1100.000000\n" +
                "182.5,182.697244,3.879422,9215.079065,45.976667,11.227500,1098.000000\n" +
                "183.5,183.500814,3.752455,9220.678741,45.976667,11.225833,1078.000000\n" +
                "184.5,185.662248,3.719715,5702.969314,46.008333,11.225833,841.000000\n" +
                "185.5,186.308228,3.925512,5711.096307,46.008333,11.225000,862.000000\n" +
                "186.5,187.595218,4.403477,5730.265886,46.008333,11.223333,911.000000\n" +
                "187.5,188.33855,4.831255,13732.093476,45.937500,11.207500,1638.000000\n" +
                "188.5,189.826208,5.334142,5583.722643,46.010000,11.220833,990.000000\n" +
                "189.5,190.838412,5.587698,5414.556348,46.011667,11.220000,998.000000\n" +
                "190.5,191.482645,5.908799,11322.655814,45.960000,11.204167,1643.000000\n" +
                "191.5,192.428557,6.729376,11093.920970,45.962500,11.202500,1777.000000\n" +
                "192.5,193.409271,7.101103,11146.378231,45.962500,11.200000,1855.000000\n" +
                "193.5,194.175717,7.620765,11099.835049,45.963333,11.198333,1949.000000\n" +
                "194.5,195.473208,8.037635,11177.766539,45.963333,11.195000,2040.000000\n" +
                "195.5,195.9263,8.447050,11116.913809,45.964167,11.194167,2110.000000\n" +
                "196.5,197.355792,8.315509,11098.051156,45.965000,11.190833,2082.000000\n" +
                "197.5,197.824522,8.316364,11028.483681,45.965833,11.190000,2072.000000\n" +
                "198.5,199.266156,8.361902,11023.922101,45.966667,11.186667,2080.000000\n" +
                "199.5,200.070695,8.586365,10986.073558,45.967500,11.185000,2117.000000\n" +
                "200.5,200.734978,8.633737,10834.455053,45.969167,11.184167,2103.000000\n" +
                "201.5,201.881772,8.615188,10817.707961,45.970000,11.181667,2097.000000\n" +
                "202.5,202.71183,8.392463,10774.143917,45.970833,11.180000,2049.000000\n" +
                "203.5,204.388331,8.381665,10706.262024,45.972500,11.176667,2037.000000\n" +
                "204.5,204.705918,8.302516,10731.157588,45.972500,11.175833,2026.000000\n" +
                "205.5,206.912464,8.240423,4422.608085,46.024167,11.207500,1104.000000\n" +
                "206.5,207.660853,8.351181,4453.747791,46.024167,11.206667,1117.000000\n" +
                "207.5,209.305562,8.727999,3560.845614,46.031667,11.210833,1010.000000\n" +
                "208.5,210.060651,9.092156,3482.877506,46.032500,11.210833,1020.000000\n" +
                "209.5,210.98246,9.457692,3519.728793,46.032500,11.210000,1048.000000\n" +
                "210.5,212.227913,9.795611,4015.170671,46.029167,11.205833,1153.000000\n" +
                "211.5,212.957372,9.989447,3938.266363,46.030000,11.205833,1153.000000\n" +
                "212.5,212.957372,9.989447,3938.266363,46.030000,11.205833,1153.000000\n" +
                "213.5,212.957372,9.989447,3938.266363,46.030000,11.205833,1153.000000\n" +
                "214.5,213.750179,9.971486,3974.056498,46.030000,11.205000,1158.000000\n" +
                "215.5,216.778799,9.899277,4124.440841,46.030000,11.201667,1179.000000\n" +
                "216.5,217.575075,10.009724,4050.852836,46.030833,11.201667,1174.000000\n" +
                "217.5,217.575075,10.009724,4050.852836,46.030833,11.201667,1174.000000\n" +
                "218.5,220.116212,10.142186,4445.884150,46.029167,11.196667,1253.000000\n" +
                "219.5,220.910109,10.408155,4377.990880,46.030000,11.196667,1261.000000\n" +
                "220.5,222.000834,10.943613,4586.991725,46.029167,11.194167,1341.000000\n" +
                "221.5,222.999657,11.487250,4798.822641,46.028333,11.191667,1426.000000\n" +
                "222.5,224.001277,12.775903,4638.711143,46.030000,11.192500,1496.000000\n" +
                "223.5,225.154689,13.475426,4745.098697,46.030000,11.190833,1576.000000\n" +
                "224.5,225.981545,14.218427,4693.375533,46.030833,11.190833,1623.000000\n" +
                "225.5,225.981545,14.218427,4693.375533,46.030833,11.190833,1623.000000\n" +
                "226.5,227.937299,14.501540,4731.373780,46.031667,11.189167,1655.000000\n" +
                "227.5,228.997217,14.890688,4839.776545,46.031667,11.187500,1714.000000\n" +
                "228.5,229.864531,14.949474,4778.681336,46.032500,11.187500,1703.000000\n" +
                "229.5,229.864531,14.949474,4778.681336,46.032500,11.187500,1703.000000\n" +
                "230.5,229.864531,14.949474,4778.681336,46.032500,11.187500,1703.000000\n" +
                "231.5,231.667851,14.656679,4650.952540,46.034167,11.187500,1647.000000\n" +
                "232.5,233.058834,14.410049,4476.061320,46.035833,11.188333,1584.000000\n" +
                "233.5,233.058834,14.410049,4476.061320,46.035833,11.188333,1584.000000\n" +
                "234.5,234.04972,14.236489,4415.754664,46.036667,11.188333,1556.000000\n" +
                "235.5,235.56123,14.012224,4410.640728,46.037500,11.187500,1538.000000\n" +
                "236.5,236.596432,13.653799,4350.572631,46.038333,11.187500,1497.000000\n" +
                "237.5,237.072199,13.550805,4404.221316,46.038333,11.186667,1502.000000\n" +
                "238.5,239.854519,13.450652,4196.138982,46.040833,11.187500,1446.000000\n" +
                "239.5,240.991772,13.624766,4152.108016,46.041667,11.187500,1448.000000\n" +
                "240.5,240.991772,13.624766,4152.108016,46.041667,11.187500,1448.000000\n" +
                "241.5,242.916355,13.986083,4009.979390,46.043333,11.188333,1439.000000\n" +
                "242.5,244.143751,14.312379,3973.079404,46.044167,11.188333,1452.000000\n" +
                "243.5,244.143751,14.312379,3973.079404,46.044167,11.188333,1452.000000\n" +
                "244.5,245.397207,14.412696,3934.034654,46.045000,11.188333,1449.000000\n" +
                "245.5,247.058752,14.502814,3957.983111,46.045833,11.187500,1461.000000\n" +
                "246.5,247.058752,14.502814,3957.983111,46.045833,11.187500,1461.000000\n" +
                "247.5,247.058752,14.502814,3957.983111,46.045833,11.187500,1461.000000\n" +
                "248.5,248.346108,14.391388,3919.647268,46.046667,11.187500,1444.000000\n" +
                "249.5,249.656885,14.098940,3880.271172,46.047500,11.187500,1415.000000\n" +
                "250.5,249.993441,13.912226,3939.489547,46.047500,11.186667,1417.000000\n" +
                "251.5,251.308249,13.593513,3902.477625,46.048333,11.186667,1387.000000\n" +
                "252.5,252.643831,13.146393,3865.732457,46.049167,11.186667,1349.000000\n" +
                "253.5,252.932553,13.012530,3926.869936,46.049167,11.185833,1354.000000\n" +
                "254.5,253.999199,12.800533,3833.021564,46.050000,11.186667,1319.000000\n" +
                "255.5,257.209294,12.772756,3913.408932,46.051667,11.185000,1335.000000\n" +
                "256.5,257.209294,12.772756,3913.408932,46.051667,11.185000,1335.000000\n" +
                "257.5,257.209294,12.772756,3913.408932,46.051667,11.185000,1335.000000\n" +
                "258.5,258.572513,12.620968,3891.092067,46.052500,11.185000,1320.000000\n" +
                "259.5,258.762771,12.604091,3955.643842,46.052500,11.184167,1333.000000\n" +
                "260.5,259.949011,12.460477,3870.922427,46.053333,11.185000,1305.000000\n" +
                "261.5,261.48335,12.049248,3914.632481,46.054167,11.184167,1287.000000\n" +
                "262.5,261.893537,11.558027,4103.048222,46.054167,11.181667,1292.000000\n" +
                "263.5,262.978145,11.483385,3958.946901,46.055000,11.183333,1258.000000\n" +
                "264.5,264.339701,10.843471,3939.726263,46.055833,11.183333,1211.000000\n" +
                "265.5,265.55833,10.015983,3790.394570,46.056667,11.185000,1129.000000\n" +
                "266.5,266.924726,9.354510,3711.464101,46.057500,11.185833,1073.000000\n" +
                "267.5,266.924726,9.354510,3711.464101,46.057500,11.185833,1073.000000\n" +
                "268.5,268.313059,8.831265,3571.632029,46.058333,11.187500,1018.000000\n" +
                "269.5,269.821071,8.366494,3630.848623,46.059167,11.186667,998.000000\n" +
                "270.5,269.821071,8.366494,3630.848623,46.059167,11.186667,998.000000\n" +
                "271.5,271.321626,7.990885,3563.162871,46.060000,11.187500,965.000000\n" +
                "272.5,272.824284,7.489744,3562.239886,46.060833,11.187500,934.000000\n" +
                "273.5,272.824284,7.489744,3562.239886,46.060833,11.187500,934.000000\n" +
                "274.5,274.32311,7.063388,3564.609080,46.061667,11.187500,908.000000\n" +
                "275.5,275.816077,6.505554,3568.651732,46.062500,11.187500,874.000000\n" +
                "276.5,275.816077,6.505554,3568.651732,46.062500,11.187500,874.000000\n" +
                "277.5,277.301207,5.992847,3575.727747,46.063333,11.187500,843.000000\n" +
                "278.5,278.621981,5.585661,3650.162194,46.064167,11.186667,825.000000\n" +
                "279.5,278.776584,5.462657,3585.356276,46.064167,11.187500,811.000000\n" +
                "280.5,280.24037,5.170024,3598.958273,46.065000,11.187500,794.000000\n" +
                "281.5,281.487118,4.916478,3678.594304,46.065833,11.186667,785.000000\n" +
                "282.5,281.690814,4.908039,3615.135238,46.065833,11.187500,779.000000\n" +
                "283.5,282.899115,4.581546,3696.374621,46.066667,11.186667,765.000000\n" +
                "284.5,286.213266,4.383166,3953.187374,46.069167,11.184167,772.000000\n" +
                "285.5,286.478586,4.438601,3891.410917,46.069167,11.185000,771.000000\n" +
                "286.5,288.074502,4.640938,3858.270209,46.070000,11.185833,782.000000\n" +
                "287.5,289.066057,4.823069,3950.205646,46.070833,11.185000,802.000000\n" +
                "288.5,289.376921,4.898962,3889.530740,46.070833,11.185833,802.000000\n" +
                "289.5,291.089775,5.647698,3590.166108,46.070833,11.190000,823.000000\n" +
                "290.5,292.078682,6.337853,3689.320650,46.071667,11.189167,877.000000\n" +
                "291.5,292.798938,7.133946,4066.990362,46.073333,11.185000,975.000000\n" +
                "292.5,292.798938,7.133946,4066.990362,46.073333,11.185000,975.000000\n" +
                "293.5,292.798938,7.133946,4066.990362,46.073333,11.185000,975.000000\n" +
                "294.5,294.000935,6.737180,4100.549787,46.074167,11.185000,951.000000\n" +
                "295.5,294.804416,5.779804,4190.458449,46.075000,11.184167,892.000000\n" +
                "296.5,295.949605,4.631801,4222.549068,46.075833,11.184167,811.000000\n" +
                "297.5,298.459746,4.748658,17769.877381,46.135000,11.031667,1961.000000\n" +
                "298.5,299.346499,4.916207,17851.977544,46.137500,11.032500,2020.000000\n" +
                "299.5,300.284278,5.256638,17355.742969,46.137500,11.040000,2079.000000\n" +
                "300.5,300.921375,5.297211,17395.518164,46.139167,11.040833,2095.000000\n" +
                "301.5,301.779063,5.224416,17855.882964,46.143333,11.037500,2116.000000\n" +
                "302.5,303.018478,5.000185,17247.903039,46.143333,11.046667,1992.000000\n" +
                "303.5,303.512801,4.814694,17185.530258,46.144167,11.048333,1931.000000\n" +
                "304.5,304.535967,4.565530,17386.583431,46.147500,11.048333,1873.000000\n" +
                "305.5,306.38936,4.509784,26834.925865,46.201667,10.954167,2627.000000\n" +
                "306.5,306.54921,4.481066,26888.818625,46.202500,10.954167,2618.000000\n" +
                "307.5,308.087443,4.382516,27764.189262,46.212500,10.950833,2642.000000\n" +
                "308.5,308.576406,4.293983,28358.918905,46.217500,10.946667,2646.000000\n" +
                "309.5,310.418894,4.259523,26832.621034,46.215000,10.969167,2510.000000\n" +
                "310.5,310.508013,4.267697,26783.691575,46.215000,10.970000,2510.000000\n" +
                "311.5,311.698939,3.995283,27260.837562,46.221667,10.970000,2418.000000\n" +
                "312.5,313.101397,3.888090,27076.964504,46.225000,10.977500,2354.000000\n" +
                "313.5,313.574437,3.767155,27105.917324,46.226667,10.979167,2299.000000\n" +
                "314.5,314.753522,3.336515,28901.993950,46.241667,10.967500,2207.000000\n" +
                "315.5,315.504799,3.190360,28911.822379,46.244167,10.970833,2134.000000\n" +
                "316.5,316.517124,3.136028,34194.168759,46.281667,10.928333,2418.000000\n" +
                "317.5,317.799153,3.081676,19541.124511,46.189167,11.063333,1545.000000\n" +
                "318.5,319.225818,2.980745,19602.765878,46.192500,11.067500,1514.000000\n" +
                "319.5,319.655658,2.951026,19476.206295,46.192500,11.070000,1497.000000\n" +
                "320.5,321.491077,3.001234,8878.846108,46.121667,11.161667,939.000000\n" +
                "321.5,321.818066,3.053958,8839.217466,46.121667,11.162500,945.000000\n" +
                "322.5,322.51605,3.029256,8872.620658,46.122500,11.163333,943.000000\n" +
                "323.5,324.716477,3.214894,5441.806568,46.099167,11.192500,776.000000\n" +
                "324.5,324.716477,3.214894,5441.806568,46.099167,11.192500,776.000000\n" +
                "325.5,326.70782,3.282108,6314.044519,46.106667,11.188333,833.000000\n" +
                "326.5,327.610749,3.502559,6471.424393,46.108333,11.188333,867.000000\n" +
                "327.5,328.94885,4.007961,6599.188843,46.110000,11.189167,933.000000\n" +
                "328.5,329.360161,4.045246,6679.210922,46.110833,11.189167,943.000000\n" +
                "329.5,329.360161,4.045246,6679.210922,46.110833,11.189167,943.000000\n" +
                "330.5,330.23691,3.982293,6726.406695,46.111667,11.190000,939.000000\n" +
                "331.5,332.791344,3.934768,6878.351003,46.114167,11.192500,944.000000\n" +
                "332.5,333.617244,3.986406,6932.519829,46.115000,11.193333,954.000000\n" +
                "333.5,333.617244,3.986406,6932.519829,46.115000,11.193333,954.000000\n" +
                "334.5,334.097286,3.920231,6903.473347,46.115000,11.194167,944.000000\n" +
                "335.5,336.191413,3.862761,6989.970450,46.116667,11.196667,943.000000\n" +
                "336.5,337.461111,3.876147,7024.557578,46.117500,11.198333,947.000000\n" +
                "337.5,337.748214,3.901193,7110.613362,46.118333,11.198333,956.000000\n" +
                "338.5,338.506732,3.835177,7172.126878,46.119167,11.199167,952.000000\n" +
                "339.5,341.019968,3.697139,4110.218692,46.094167,11.215833,735.000000\n" +
                "340.5,341.875572,4.414225,4093.316924,46.094167,11.216667,785.000000\n" +
                "341.5,342.739632,4.603815,4074.728940,46.094167,11.217500,797.000000\n" +
                "342.5,343.974545,4.897151,4147.023109,46.095000,11.218333,824.000000\n" +
                "343.5,344.837137,5.249380,4131.891174,46.095000,11.219167,848.000000\n" +
                "344.5,346.019936,5.767301,4209.330222,46.095833,11.220000,893.000000\n" +
                "345.5,346.878646,5.951192,4195.530913,46.095833,11.220833,905.000000\n" +
                "346.5,348.084829,6.221080,3987.560303,46.094167,11.222500,902.000000\n" +
                "347.5,348.73676,6.475575,3885.161746,46.093333,11.223333,908.000000\n" +
                "348.5,349.719062,6.642609,4252.994611,46.096667,11.223333,962.000000\n" +
                "349.5,349.719062,6.642609,4252.994611,46.096667,11.223333,962.000000\n" +
                "350.5,350.393765,6.642427,3771.208507,46.092500,11.225000,906.000000\n" +
                "351.5,352.709996,6.913673,3938.908353,46.094167,11.226667,944.000000\n" +
                "352.5,353.648631,6.999492,3931.914038,46.094167,11.227500,949.000000\n" +
                "353.5,353.648631,6.999492,3931.914038,46.094167,11.227500,949.000000\n" +
                "354.5,355.779046,6.961256,3262.959134,46.088333,11.230000,865.000000\n" +
                "355.5,356.917729,7.022386,3259.248804,46.088333,11.230833,868.000000\n" +
                "356.5,356.917729,7.022386,3259.248804,46.088333,11.230833,868.000000\n" +
                "357.5,356.917729,7.022386,3259.248804,46.088333,11.230833,868.000000\n" +
                "358.5,358.058857,6.853807,3255.230579,46.088333,11.231667,858.000000\n" +
                "359.5,0.309328,7.222179,3629.555891,46.091667,11.233333,926.000000";

        //Faccio il parsing della stringa e butto i dati nella libreria per generare grafici
        List<Entry> entries = new ArrayList<Entry>();
        List<Entry> entries_sole = new ArrayList<Entry>();

        List<String> lines = Arrays.asList(peak.split("[\\r\\n]+"));
        List<String> lines_sole = Arrays.asList(traiettoria.split("[\\r\\n]+"));

        for(int a = 1; a< lines.size(); a++){
            List<String> tempsplit = Arrays.asList(lines.get(a).split(","));
            entries.add(new Entry(Float.parseFloat(tempsplit.get(1)), Float.parseFloat(tempsplit.get(6))));
        }

        for(int a = 1; a< lines_sole.size(); a++){
            List<String> tempsplit = Arrays.asList(lines_sole.get(a).split(","));
            entries_sole.add(new Entry(Float.parseFloat(tempsplit.get(1)), Float.parseFloat(tempsplit.get(6))));
        }

        LineChart chart = (LineChart) findViewById(R.id.chart);
        chart.setDrawGridBackground(false);
        chart.setMaxHighlightDistance(300);
        chart.getXAxis().setEnabled(false);
        chart.getAxisRight().setEnabled(false);

        LineDataSet dataSet = new LineDataSet(entries, "Profilo montagne"); // add entries to dataset
        dataSet.setMode(LineDataSet.Mode.LINEAR);

        dataSet.setColor(ContextCompat.getColor(getApplicationContext(),R.color.pale_green));
        dataSet.setLineWidth(0.5f);
        dataSet.setDrawValues(false);
        dataSet.setDrawCircles(false);
        dataSet.setDrawFilled(false);

        LineDataSet sole = new LineDataSet(entries_sole, "Traiettoria sole");
        sole.setColor(Color.RED);
        sole.setDrawCircles(false);

        chart.getDescription().setText("Profilo montagne");
        LineData lineData = new LineData(dataSet, sole);
        chart.getXAxis().setDrawGridLines(false);
        chart.setData(lineData);
        chart.animateX(2500);
        chart.invalidate();
    }
}
